<%- include('header') %>

<div class="auth-layout">
    <div class="auth-card" style="max-width: 500px; width: 100%;">
        
        <!-- Header -->
        <div style="display: flex; align-items: center; margin-bottom: 2rem;">
            <a href="/pricing" style="color: var(--text-muted); text-decoration: none; font-size: 0.9rem; display: flex; align-items: center;">
                <span style="margin-right: 5px;">‚Üê</span> Back
            </a>
            <div style="margin-left: auto; color: var(--primary); font-weight: bold; background: rgba(139, 92, 246, 0.1); padding: 5px 10px; border-radius: 4px; font-size: 0.8rem;">
                SECURE CHECKOUT
            </div>
        </div>

        <h1 style="margin-top: 0; margin-bottom: 0.5rem;">Upgrade Subscription</h1>
        <p style="color: var(--text-muted); margin-bottom: 2rem;">
            You are purchasing the <strong style="color: var(--text-main);"><%= plan.charAt(0).toUpperCase() + plan.slice(1) %></strong> plan.
        </p>

        <!-- Mock Mode Notice for Professor -->
        <div style="background: rgba(34, 197, 94, 0.1); border: 1px dashed #22c55e; color: #4ade80; padding: 0.75rem; border-radius: 6px; font-size: 0.85rem; margin-bottom: 2rem; text-align: center;">
            üß™ <strong>Payment is Safe and Secure</strong><br>
        </div>

        <!-- Payment Method Tabs -->
        <div style="display: flex; gap: 1rem; border-bottom: 1px solid var(--border); margin-bottom: 1.5rem;">
            <button type="button" onclick="selectMethod('card')" id="tab-card" class="pay-tab active" style="background:none; border:none; border-bottom: 2px solid var(--primary); color: white; padding-bottom: 0.5rem; cursor: pointer; font-weight: bold;">
                Credit Card
            </button>
            <button type="button" onclick="selectMethod('ewallet')" id="tab-ewallet" class="pay-tab" style="background:none; border:none; border-bottom: 2px solid transparent; color: var(--text-muted); padding-bottom: 0.5rem; cursor: pointer;">
                GCash / Maya
            </button>
            <button type="button" onclick="selectMethod('paypal')" id="tab-paypal" class="pay-tab" style="background:none; border:none; border-bottom: 2px solid transparent; color: var(--text-muted); padding-bottom: 0.5rem; cursor: pointer;">
                PayPal
            </button>
        </div>

        <!-- The Payment Form -->
        <form action="/process-payment" method="POST" id="payment-form">
            <input type="hidden" name="plan" value="<%= plan %>">
            <input type="hidden" name="method" id="input-method" value="credit_card">

            <!-- 1. CREDIT CARD FIELDS -->
            <div id="form-card" class="method-section">
                <div class="form-group">
                    <label style="font-size: 0.9rem; color: var(--text-muted); display: block; margin-bottom: 5px;">Card Number</label>
                    <input type="text" placeholder="0000 0000 0000 0000" class="modern-input" style="font-family: monospace; letter-spacing: 2px;">
                </div>
                <div style="display: flex; gap: 1rem;">
                    <div class="form-group" style="flex: 1;">
                        <label style="font-size: 0.9rem; color: var(--text-muted); display: block; margin-bottom: 5px;">Expiry</label>
                        <input type="text" placeholder="MM / YY" class="modern-input">
                    </div>
                    <div class="form-group" style="flex: 1;">
                        <label style="font-size: 0.9rem; color: var(--text-muted); display: block; margin-bottom: 5px;">CVC</label>
                        <input type="text" placeholder="123" class="modern-input">
                    </div>
                </div>
            </div>

            <!-- 2. E-WALLET FIELDS -->
            <div id="form-ewallet" class="method-section" style="display: none;">
                <div class="form-group">
                    <label style="font-size: 0.9rem; color: var(--text-muted); display: block; margin-bottom: 5px;">Select Wallet</label>
                    <select class="modern-input">
                        <option>GCash</option>
                        <option>Maya</option>
                    </select>
                </div>
                <div class="form-group">
                    <label style="font-size: 0.9rem; color: var(--text-muted); display: block; margin-bottom: 5px;">Mobile Number</label>
                    <input type="text" placeholder="09XX XXX XXXX" class="modern-input">
                </div>
            </div>

            <!-- 3. PAYPAL FIELDS -->
            <div id="form-paypal" class="method-section" style="display: none; text-align: center; padding: 1rem 0;">
                <p style="color: var(--text-muted); margin-bottom: 1.5rem;">You will be redirected to PayPal to verify your account.</p>
                <div style="background: #003087; color: white; font-weight: bold; padding: 1rem; border-radius: 6px; display: inline-block; width: 100%; box-sizing: border-box;">
                    Pay with PayPal
                </div>
            </div>

            <!-- Submit Button -->
            <button type="submit" class="btn-primary" style="margin-top: 2rem; width: 100%;">
                Confirm Payment
            </button>
            
            <p style="text-align: center; font-size: 0.8rem; color: var(--text-muted); margin-top: 1rem;">
                By clicking confirm, you agree to our <a href="/legal" style="color: var(--primary);">Terms of Service</a>.
            </p>
        </form>
    </div>
</div>

<!-- CLIENT SIDE SCRIPT FOR TABS -->
<script>
    function selectMethod(methodName) {
        // 1. Update Hidden Input
        document.getElementById('input-method').value = methodName;

        // 2. Hide All Form Sections
        document.querySelectorAll('.method-section').forEach(el => el.style.display = 'none');

        // 3. Show Selected Form Section
        document.getElementById('form-' + methodName).style.display = 'block';

        // 4. Reset Tab Styles
        document.querySelectorAll('.pay-tab').forEach(el => {
            el.style.color = 'var(--text-muted)';
            el.style.borderBottom = '2px solid transparent';
            el.classList.remove('active');
        });

        // 5. Highlight Active Tab
        const activeTab = document.getElementById('tab-' + methodName);
        activeTab.style.color = 'white';
        activeTab.style.borderBottom = '2px solid var(--primary)';
        activeTab.classList.add('active');
    }
</script>

<%- include('footer') %>